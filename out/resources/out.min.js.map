{"version":3,"file":"out.min.js","sources":["../../resources/js/MappableField.js","../../resources/js/out.js"],"sourcesContent":["export default class MappableField {\n\t\n\tconstructor (handle, name, type, label, twig, enabled) {\n\t\tif (typeof handle === typeof {}) {\n\t\t\treturn MappableField.fromObject(handle);\n\t\t}\n\t\t\n\t\tthis.handle = handle;\n\t\tthis.name = name;\n\t\tthis.type = type;\n\t\tthis.label = label;\n\t\tthis.twig = twig;\n\t\tthis.enabled = enabled;\n\t}\n\t\n\tstatic fromObject (o) {\n\t\treturn new MappableField(\n\t\t\to.handle,\n\t\t\to.name,\n\t\t\to.type,\n\t\t\to.label || o.name,\n\t\t\to.twig || \"\",\n\t\t\to.enabled || false\n\t\t);\n\t}\n\t\n}","/* global Garnish */\nimport MappableField from \"./MappableField\";\n\nclass Out { // eslint-disable-line no-unused-vars\n\t\n\tconstructor (types, fields, mapping) {\n\t\tthis.types = types;\n\t\tthis.fields = fields;\n\t\tthis.mapping = mapping ? mapping : [];\n\t\tthis.channelField = document.getElementById(\"channel\");\n\t\tthis.typeField = document.getElementById(\"type\");\n\t\tthis.mappingField = document.getElementById(\"mappingField\");\n\t\tthis.mappingContainer = document.getElementById(\"mapping\");\n\t\t\n\t\tthis.sort = null;\n\t\tthis.modal = null;\n\t\t\n\t\tthis.bindEvents();\n\t\tthis.initializeOrUpdateMapping();\n\t}\n\t\n\t// Mapping\n\t// =========================================================================\n\t\n\tinitializeOrUpdateMapping () {\n\t\tif (this.sort)\n\t\t\tthis.sort.destroy();\n\t\t\n\t\twhile (this.mappingContainer.firstElementChild)\n\t\t\tthis.mappingContainer.removeChild(\n\t\t\t\tthis.mappingContainer.firstElementChild\n\t\t\t);\n\t\t\n\t\tconst fieldsOfType = this.fields[this.typeField.value];\n\t\tconst validFieldHandles = fieldsOfType.map(field => field.handle);\n\t\t\n\t\tconst handlesFromMapping = [];\n\t\tthis.mapping = fieldsOfType.reduce((a, b) => {\n\t\t\tif (handlesFromMapping.indexOf(b.handle) > -1)\n\t\t\t\treturn a;\n\t\t\t\n\t\t\ta.push(new MappableField(\n\t\t\t\tb.handle,\n\t\t\t\tb.name,\n\t\t\t\tb.type,\n\t\t\t\tb.name,\n\t\t\t\t\"\",\n\t\t\t\tfalse\n\t\t\t));\n\t\t\t\n\t\t\treturn a;\n\t\t}, this.mapping.reduce((a, b) => {\n\t\t\tif (validFieldHandles.indexOf(b.handle) === -1)\n\t\t\t\treturn a;\n\t\t\t\n\t\t\thandlesFromMapping.push(b.handle);\n\t\t\ta.push(new MappableField(b));\n\t\t\treturn a;\n\t\t}, []));\n\t\t\n\t\tconst rows = this.mapping.map(field => {\n\t\t\tconst enabledAttrs = {\n\t\t\t\t\"type\": \"checkbox\",\n\t\t\t\t\"change\": this.onEnabledChange.bind(this),\n\t\t\t};\n\t\t\t\n\t\t\tif (field.enabled)\n\t\t\t\tenabledAttrs.checked = true;\n\t\t\t\n\t\t\tconst row = Out.createElement(\"li\", {\n\t\t\t\t\"class\": \"out--mapping-field\",\n\t\t\t\t\"data-handle\": field.handle,\n\t\t\t}, [\n\t\t\t\tOut.createElement(\"span\", {}, [\n\t\t\t\t\t\n\t\t\t\t\tOut.createElement(\"span\", {\n\t\t\t\t\t\t\"class\": \"name\",\n\t\t\t\t\t}, field.name),\n\t\t\t\t\t\n\t\t\t\t\tOut.createElement(\"span\", {\n\t\t\t\t\t\t\"class\": \"type\",\n\t\t\t\t\t}, `(${field.type})`),\n\t\t\t\t\t\n\t\t\t\t\tOut.createElement(\"span\", {\n\t\t\t\t\t\t\"class\": \"type\",\n\t\t\t\t\t}, field.label !== field.name ? field.label : \"\"),\n\t\t\t\t\n\t\t\t\t]),\n\t\t\t\t\n\t\t\t\tOut.createElement(\"span\", {}, [\n\t\t\t\t\n\t\t\t\t\tOut.createElement(\"label\", {}, [\n\t\t\t\t\t\t\"Enabled\",\n\t\t\t\t\t\tOut.createElement(\"input\", enabledAttrs),\n\t\t\t\t\t]),\n\t\t\t\t\t\n\t\t\t\t\tOut.createElement(\"a\", {\n\t\t\t\t\t\t\"class\": \"icon settings\",\n\t\t\t\t\t\t\"href\": \"#\",\n\t\t\t\t\t\t\"click\": this.onSettingsClick.bind(this, field),\n\t\t\t\t\t}),\n\t\t\t\t\t\n\t\t\t\t]),\n\t\t\t]);\n\t\t\t\n\t\t\tthis.mappingContainer.appendChild(row);\n\t\t\t\n\t\t\treturn row;\n\t\t});\n\t\t\n\t\tthis.sort = new Garnish.DragSort(rows, {\n\t\t\taxis: Garnish.Y_AXIS,\n\t\t\tonSortChange: this.onMappingChange.bind(this),\n\t\t});\n\t\t\n\t\tthis.onMappingChange();\n\t}\n\t\n\t// Events\n\t// =========================================================================\n\t\n\tbindEvents () {\n\t\tthis.channelField.addEventListener(\n\t\t\t\"change\",\n\t\t\tthis.onChannelChange.bind(this)\n\t\t);\n\t\tthis.typeField.addEventListener(\n\t\t\t\"change\",\n\t\t\tthis.onTypeChange.bind(this)\n\t\t);\n\t}\n\t\n\tonChannelChange () {\n\t\twhile (this.typeField.firstElementChild)\n\t\t\tthis.typeField.removeChild(this.typeField.firstElementChild);\n\t\t\n\t\tconst types = this.types[this.channelField.value];\n\t\t\n\t\tfor (let [value, label] of Object.entries(types)) {\n\t\t\tconst opts = { value };\n\t\t\tif (Object.keys(types).indexOf(value) === 0)\n\t\t\t\topts[\"selected\"] = true;\n\t\t\t\n\t\t\tthis.typeField.appendChild(\n\t\t\t\tOut.createElement(\"option\", opts, label)\n\t\t\t);\n\t\t}\n\t\t\n\t\tthis.initializeOrUpdateMapping();\n\t}\n\t\n\tonTypeChange () {\n\t\tthis.initializeOrUpdateMapping();\n\t}\n\t\n\tonEnabledChange () {\n\t\tthis.onMappingChange();\n\t}\n\t\n\tonSettingsClick (field, e) {\n\t\te.preventDefault();\n\t\t\n\t\tif (this.modal)\n\t\t\tthis.modal.destroy();\n\t\t\n\t\tthis.modal = new Garnish.Modal(\n\t\t\tOut.createElement(\"div\", {\n\t\t\t\t\"class\": \"modal out--modal\"\n\t\t\t}, [\n\t\t\t\tOut.createElement(\"div\", { \"class\": \"body\" }, [\n\t\t\t\t\tOut.createField(\"Label\", \"outModalLabel\", \"input\", {\n\t\t\t\t\t\t\"class\": \"text fullwidth\",\n\t\t\t\t\t\t\"value\": field.label,\n\t\t\t\t\t}, \"How the input will be labeled in the report\"),\n\t\t\t\t\tOut.createField(\n\t\t\t\t\t\t\"Twig\",\n\t\t\t\t\t\t\"outModalTwig\",\n\t\t\t\t\t\t\"textarea\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"class\": \"text fullwidth\",\n\t\t\t\t\t\t\t\"rows\": 5\n\t\t\t\t\t\t},\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\"Code to be executed in place of the fields output. You have access to the \",\n\t\t\t\t\t\t\tOut.createElement(\"code\", {}, field.handle),\n\t\t\t\t\t\t\t\" variable as well as all global & Craft variables.\"\n\t\t\t\t\t\t],\n\t\t\t\t\t\tfield.twig\n\t\t\t\t\t),\n\t\t\t\t]),\n\t\t\t\tOut.createElement(\"div\", { \"class\": \"footer\" }, [\n\t\t\t\t\tOut.createElement(\"div\", { \"class\": \"buttons right\" }, [\n\t\t\t\t\t\tOut.createElement(\"button\", {\n\t\t\t\t\t\t\t\"class\": \"btn\",\n\t\t\t\t\t\t\t\"click\": this.onCancelModal.bind(this)\n\t\t\t\t\t\t}, \"Cancel\"),\n\t\t\t\t\t\tOut.createElement(\"button\", {\n\t\t\t\t\t\t\t\"class\": \"btn submit\",\n\t\t\t\t\t\t\t\"click\": this.onSubmitModal.bind(this, field)\n\t\t\t\t\t\t}, \"Update\"),\n\t\t\t\t\t])\n\t\t\t\t]),\n\t\t\t])\n\t\t);\n\t}\n\t\n\tonCancelModal () {\n\t\tif (this.modal)\n\t\t\tthis.modal.hide();\n\t}\n\t\n\tonSubmitModal (field) {\n\t\tthis.mapping = this.mapping.map(f => {\n\t\t\tif (f.handle !== field.handle)\n\t\t\t\treturn f;\n\t\t\t\n\t\t\treturn new MappableField({\n\t\t\t\t...f,\n\t\t\t\tlabel: document.getElementById(\"outModalLabel\").value,\n\t\t\t\ttwig: document.getElementById(\"outModalTwig\").value,\n\t\t\t});\n\t\t});\n\t\t\n\t\tif (this.modal)\n\t\t\tthis.modal.hide();\n\t\t\n\t\tthis.initializeOrUpdateMapping();\n\t}\n\t\n\tonMappingChange () {\n\t\tconst mapByHandle = this.mapping.reduce((a, b) => {\n\t\t\ta[b.handle] = b;\n\t\t\treturn a;\n\t\t}, {});\n\t\t\n\t\tthis.mapping = [].slice.call(this.mappingContainer.children).map(child => {\n\t\t\tconst ret = mapByHandle[child.dataset.handle];\n\t\t\tret.enabled = child.getElementsByTagName(\"input\")[0].checked;\n\t\t\t\n\t\t\treturn ret;\n\t\t});\n\t\t\n\t\tthis.mappingField.value = JSON.stringify(this.mapping);\n\t}\n\t\n\t// Helpers\n\t// =========================================================================\n\t\n\tstatic createElement (tag = \"div\", attributes = {}, children = []) {\n\t\tconst elem = document.createElement(tag);\n\t\t\n\t\tfor (let [key, value] of Object.entries(attributes)) {\n\t\t\tif (typeof value === typeof (() => {})) {\n\t\t\t\telem.addEventListener(key, value);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\n\t\t\telem.setAttribute(key, value);\n\t\t}\n\t\t\n\t\tif (!Array.isArray(children))\n\t\t\tchildren = [children];\n\t\t\n\t\tchildren.map(child => {\n\t\t\ttry {\n\t\t\t\telem.appendChild(child);\n\t\t\t} catch (_) {\n\t\t\t\telem.appendChild(document.createTextNode(child));\n\t\t\t}\n\t\t});\n\t\t\n\t\treturn elem;\n\t}\n\t\n\tstatic createField (label, id, tag = \"input\", attributes = {}, instructions = null, children = null) {\n\t\treturn Out.createElement(\"div\", { \"class\": \"field\" }, [\n\t\t\tOut.createElement(\"div\", { \"class\": \"heading\" }, [\n\t\t\t\tOut.createElement(\"label\", { \"for\": id }, label),\n\t\t\t\tinstructions ? Out.createElement(\"div\", {\n\t\t\t\t\t\"class\": \"instructions\"\n\t\t\t\t}, Out.createElement(\"p\", {}, instructions)) : \"\"\n\t\t\t]),\n\t\t\tOut.createElement(\"div\", { \"class\": \"input\" }, [\n\t\t\t\tOut.createElement(tag, {\n\t\t\t\t\tid,\n\t\t\t\t\t...attributes,\n\t\t\t\t}, children)\n\t\t\t])\n\t\t]);\n\t}\n\t\n}"],"names":["MappableField","handle","name","type","label","twig","enabled","fromObject","o","Out","types","fields","mapping","channelField","document","getElementById","typeField","mappingField","mappingContainer","sort","modal","bindEvents","initializeOrUpdateMapping","this","destroy","firstElementChild","removeChild","fieldsOfType","value","validFieldHandles","map","field","handlesFromMapping","reduce","a","b","indexOf","push","rows","enabledAttrs","_this","onEnabledChange","bind","checked","row","createElement","onSettingsClick","appendChild","Garnish","DragSort","Y_AXIS","onMappingChange","addEventListener","onChannelChange","onTypeChange","Object","entries","opts","keys","e","preventDefault","Modal","class","createField","onCancelModal","onSubmitModal","hide","f","mapByHandle","slice","call","children","ret","child","dataset","getElementsByTagName","JSON","stringify","tag","attributes","elem","key","setAttribute","Array","isArray","_","createTextNode","id","instructions","for"],"mappings":"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"}
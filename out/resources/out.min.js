var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},slicedToArray=function(){function e(e,t){var n=[],i=!0,a=!1,l=void 0;try{for(var r,o=e[Symbol.iterator]();!(i=(r=o.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){a=!0,l=e}finally{try{!i&&o.return&&o.return()}finally{if(a)throw l}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},MappableField=function(){function e(t,n,i,a,l,r){if(classCallCheck(this,e),(void 0===t?"undefined":_typeof(t))===_typeof({}))return e.fromObject(t);this.handle=t,this.name=n,this.type=i,this.label=a,this.twig=l,this.enabled=r}return createClass(e,null,[{key:"fromObject",value:function(t){return new e(t.handle,t.name,t.type,t.label||t.name,t.twig||"",t.enabled||!1)}}]),e}(),Out=function(){function e(t,n,i){classCallCheck(this,e),this.types=t,this.fields=n,this.mapping=i||[],this.channelField=document.getElementById("channel"),this.typeField=document.getElementById("type"),this.mappingField=document.getElementById("mappingField"),this.mappingContainer=document.getElementById("mapping"),this.sortField=document.getElementById("sortField"),this.sortDir=document.getElementById("sortDir"),this.sortingField=document.getElementById("sorting"),this.sort=null,this.modal=null,this.bindEvents(),this.initializeOrUpdateMapping()}return createClass(e,[{key:"initializeOrUpdateMapping",value:function(){var t=this;for(this.sort&&this.sort.destroy();this.mappingContainer.firstElementChild;)this.mappingContainer.removeChild(this.mappingContainer.firstElementChild);var n=[].concat(toConsumableArray(this.fields[-1]),toConsumableArray(this.fields[this.typeField.value])),i=n.map(function(e){return e.handle}),a=[];this.mapping=n.reduce(function(e,t){return a.indexOf(t.handle)>-1?e:(e.push(new MappableField(t.handle,t.name,t.type,t.name,"",!0)),e)},this.mapping.reduce(function(e,t){return-1===i.indexOf(t.handle)?e:(a.push(t.handle),e.push(new MappableField(t)),e)},[]));var l=this.mapping.map(function(n){var i={type:"checkbox",change:t.onEnabledChange.bind(t)};n.enabled&&(i.checked=!0);var a=e.createElement("li",{class:"out--mapping-field","data-handle":n.handle},[e.createElement("span",{},[e.createElement("span",{class:"name"},n.name),e.createElement("span",{class:"type"},"("+n.type+")"),e.createElement("span",{class:"type"},n.label!==n.name?n.label:"")]),e.createElement("span",{},[e.createElement("label",{},["Enabled",e.createElement("input",i)]),e.createElement("a",{class:"icon settings",href:"#",click:t.onSettingsClick.bind(t,n)})])]);return t.mappingContainer.appendChild(a),a});this.sort=new Garnish.DragSort(l,{axis:Garnish.Y_AXIS,onSortChange:this.onMappingChange.bind(this)}),this.onMappingChange(),this.initializeSorting(n)}},{key:"initializeSorting",value:function(t){for(var n=this;this.sortField.firstElementChild;)this.sortField.removeChild(this.sortField.firstElementChild);var i=this.sortingField.value.split(" "),a=slicedToArray(i,2),l=a[0],r=a[1];t.forEach(function(t){var i={value:t.handle};l&&l===t.handle&&(i.selected=!0),n.sortField.appendChild(e.createElement("option",i,t.name))}),r&&(this.sortDir.value=r),this.onSortChange()}},{key:"bindEvents",value:function(){this.channelField.addEventListener("change",this.onChannelChange.bind(this)),this.typeField.addEventListener("change",this.onTypeChange.bind(this)),this.sortField.addEventListener("change",this.onSortChange.bind(this)),this.sortDir.addEventListener("change",this.onSortChange.bind(this))}},{key:"onChannelChange",value:function(){for(;this.typeField.firstElementChild;)this.typeField.removeChild(this.typeField.firstElementChild);var t=this.types[this.channelField.value],n=!0,i=!1,a=void 0;try{for(var l,r=Object.entries(t)[Symbol.iterator]();!(n=(l=r.next()).done);n=!0){var o=l.value,s=slicedToArray(o,2),d=s[0],h=s[1],c={value:d};0===Object.keys(t).indexOf(d)&&(c.selected=!0),this.typeField.appendChild(e.createElement("option",c,h))}}catch(e){i=!0,a=e}finally{try{!n&&r.return&&r.return()}finally{if(i)throw a}}this.initializeOrUpdateMapping()}},{key:"onTypeChange",value:function(){this.initializeOrUpdateMapping()}},{key:"onEnabledChange",value:function(){this.onMappingChange()}},{key:"onSettingsClick",value:function(t,n){n.preventDefault(),this.modal&&this.modal.destroy(),this.modal=new Garnish.Modal(e.createElement("div",{class:"modal out--modal"},[e.createElement("div",{class:"body"},[e.createField("Label","outModalLabel","input",{class:"text fullwidth",value:t.label},"How the input will be labeled in the report"),e.createField("Twig","outModalTwig","textarea",{class:"text fullwidth",rows:5},["Code to be executed in place of the fields output. You have access to the ",e.createElement("code",{},t.handle)," variable as well as all global & Craft variables."],t.twig)]),e.createElement("div",{class:"footer"},[e.createElement("div",{class:"buttons right"},[e.createElement("button",{class:"btn",click:this.onCancelModal.bind(this)},"Cancel"),e.createElement("button",{class:"btn submit",click:this.onSubmitModal.bind(this,t)},"Update")])])]))}},{key:"onCancelModal",value:function(){this.modal&&this.modal.hide()}},{key:"onSubmitModal",value:function(e){this.mapping=this.mapping.map(function(t){return t.handle!==e.handle?t:new MappableField(_extends({},t,{label:document.getElementById("outModalLabel").value,twig:document.getElementById("outModalTwig").value}))}),this.modal&&this.modal.hide(),this.initializeOrUpdateMapping()}},{key:"onMappingChange",value:function(){var e=this.mapping.reduce(function(e,t){return e[t.handle]=t,e},{});this.mapping=[].slice.call(this.mappingContainer.children).map(function(t){var n=e[t.dataset.handle];return n.enabled=t.getElementsByTagName("input")[0].checked,n}),this.mappingField.value=JSON.stringify(this.mapping)}},{key:"onSortChange",value:function(){this.sortingField.value=this.sortField.value+" "+this.sortDir.value}}],[{key:"createElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=document.createElement(e),a=!0,l=!1,r=void 0;try{for(var o,s=Object.entries(t)[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var d=o.value,h=slicedToArray(d,2),c=h[0],u=h[1];(void 0===u?"undefined":_typeof(u))!==_typeof(function(){})?i.setAttribute(c,u):i.addEventListener(c,u)}}catch(e){l=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(l)throw r}}return Array.isArray(n)||(n=[n]),n.map(function(e){try{i.appendChild(e)}catch(t){i.appendChild(document.createTextNode(e))}}),i}},{key:"createField",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"input",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return e.createElement("div",{class:"field"},[e.createElement("div",{class:"heading"},[e.createElement("label",{for:n},t),l?e.createElement("div",{class:"instructions"},e.createElement("p",{},l)):""]),e.createElement("div",{class:"input"},[e.createElement(i,_extends({id:n},a),r)])])}}]),e}();
//# sourceMappingURL=out.min.js.map

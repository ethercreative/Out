var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},slicedToArray=function(){function e(e,t){var n=[],a=!0,i=!1,l=void 0;try{for(var r,o=e[Symbol.iterator]();!(a=(r=o.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){i=!0,l=e}finally{try{!a&&o.return&&o.return()}finally{if(i)throw l}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},MappableField=function(){function e(t,n,a,i,l,r){if(classCallCheck(this,e),(void 0===t?"undefined":_typeof(t))===_typeof({}))return e.fromObject(t);this.handle=t,this.name=n,this.type=a,this.label=i,this.twig=l,this.enabled=r}return createClass(e,null,[{key:"fromObject",value:function(t){return new e(t.handle,t.name,t.type,t.label||t.name,t.twig||"",t.enabled||!1)}}]),e}(),Out=function(){function e(t,n,a){classCallCheck(this,e),this.types=t,this.fields=n,this.mapping=a||[],this.channelField=document.getElementById("channel"),this.typeField=document.getElementById("type"),this.mappingField=document.getElementById("mappingField"),this.mappingContainer=document.getElementById("mapping"),this.sort=null,this.modal=null,this.bindEvents(),this.initializeOrUpdateMapping()}return createClass(e,[{key:"initializeOrUpdateMapping",value:function(){var t=this;for(this.sort&&this.sort.destroy();this.mappingContainer.firstElementChild;)this.mappingContainer.removeChild(this.mappingContainer.firstElementChild);var n=[].concat(toConsumableArray(this.fields[-1]),toConsumableArray(this.fields[this.typeField.value])),a=n.map(function(e){return e.handle}),i=[];this.mapping=n.reduce(function(e,t){return i.indexOf(t.handle)>-1?e:(e.push(new MappableField(t.handle,t.name,t.type,t.name,"",!0)),e)},this.mapping.reduce(function(e,t){return-1===a.indexOf(t.handle)?e:(i.push(t.handle),e.push(new MappableField(t)),e)},[]));var l=this.mapping.map(function(n){var a={type:"checkbox",change:t.onEnabledChange.bind(t)};n.enabled&&(a.checked=!0);var i=e.createElement("li",{class:"out--mapping-field","data-handle":n.handle},[e.createElement("span",{},[e.createElement("span",{class:"name"},n.name),e.createElement("span",{class:"type"},"("+n.type+")"),e.createElement("span",{class:"type"},n.label!==n.name?n.label:"")]),e.createElement("span",{},[e.createElement("label",{},["Enabled",e.createElement("input",a)]),e.createElement("a",{class:"icon settings",href:"#",click:t.onSettingsClick.bind(t,n)})])]);return t.mappingContainer.appendChild(i),i});this.sort=new Garnish.DragSort(l,{axis:Garnish.Y_AXIS,onSortChange:this.onMappingChange.bind(this)}),this.onMappingChange()}},{key:"bindEvents",value:function(){this.channelField.addEventListener("change",this.onChannelChange.bind(this)),this.typeField.addEventListener("change",this.onTypeChange.bind(this))}},{key:"onChannelChange",value:function(){for(;this.typeField.firstElementChild;)this.typeField.removeChild(this.typeField.firstElementChild);var t=this.types[this.channelField.value],n=!0,a=!1,i=void 0;try{for(var l,r=Object.entries(t)[Symbol.iterator]();!(n=(l=r.next()).done);n=!0){var o=l.value,s=slicedToArray(o,2),d=s[0],c=s[1],h={value:d};0===Object.keys(t).indexOf(d)&&(h.selected=!0),this.typeField.appendChild(e.createElement("option",h,c))}}catch(e){a=!0,i=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw i}}this.initializeOrUpdateMapping()}},{key:"onTypeChange",value:function(){this.initializeOrUpdateMapping()}},{key:"onEnabledChange",value:function(){this.onMappingChange()}},{key:"onSettingsClick",value:function(t,n){n.preventDefault(),this.modal&&this.modal.destroy(),this.modal=new Garnish.Modal(e.createElement("div",{class:"modal out--modal"},[e.createElement("div",{class:"body"},[e.createField("Label","outModalLabel","input",{class:"text fullwidth",value:t.label},"How the input will be labeled in the report"),e.createField("Twig","outModalTwig","textarea",{class:"text fullwidth",rows:5},["Code to be executed in place of the fields output. You have access to the ",e.createElement("code",{},t.handle)," variable as well as all global & Craft variables."],t.twig)]),e.createElement("div",{class:"footer"},[e.createElement("div",{class:"buttons right"},[e.createElement("button",{class:"btn",click:this.onCancelModal.bind(this)},"Cancel"),e.createElement("button",{class:"btn submit",click:this.onSubmitModal.bind(this,t)},"Update")])])]))}},{key:"onCancelModal",value:function(){this.modal&&this.modal.hide()}},{key:"onSubmitModal",value:function(e){this.mapping=this.mapping.map(function(t){return t.handle!==e.handle?t:new MappableField(_extends({},t,{label:document.getElementById("outModalLabel").value,twig:document.getElementById("outModalTwig").value}))}),this.modal&&this.modal.hide(),this.initializeOrUpdateMapping()}},{key:"onMappingChange",value:function(){var e=this.mapping.reduce(function(e,t){return e[t.handle]=t,e},{});this.mapping=[].slice.call(this.mappingContainer.children).map(function(t){var n=e[t.dataset.handle];return n.enabled=t.getElementsByTagName("input")[0].checked,n}),this.mappingField.value=JSON.stringify(this.mapping)}}],[{key:"createElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=document.createElement(e),i=!0,l=!1,r=void 0;try{for(var o,s=Object.entries(t)[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var d=o.value,c=slicedToArray(d,2),h=c[0],u=c[1];(void 0===u?"undefined":_typeof(u))!==_typeof(function(){})?a.setAttribute(h,u):a.addEventListener(h,u)}}catch(e){l=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(l)throw r}}return Array.isArray(n)||(n=[n]),n.map(function(e){try{a.appendChild(e)}catch(t){a.appendChild(document.createTextNode(e))}}),a}},{key:"createField",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"input",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return e.createElement("div",{class:"field"},[e.createElement("div",{class:"heading"},[e.createElement("label",{for:n},t),l?e.createElement("div",{class:"instructions"},e.createElement("p",{},l)):""]),e.createElement("div",{class:"input"},[e.createElement(a,_extends({id:n},i),r)])])}}]),e}();
//# sourceMappingURL=out.min.js.map
